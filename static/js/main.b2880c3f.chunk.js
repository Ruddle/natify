(this.webpackJsonpnatify=this.webpackJsonpnatify||[]).push([[0],{129:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return EditorFrag}));var _home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(134),_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(31),_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(24),_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(42),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_4__),react_simple_code_editor__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(130),react_simple_code_editor__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(react_simple_code_editor__WEBPACK_IMPORTED_MODULE_5__),prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(78),prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_6__),prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(141),prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_7__),prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(142),prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_8__),_testing_library_dom__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(143),_RSlider__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(132),react_flow_renderer__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(43),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__),qs=__webpack_require__(436),cloneDeep=__webpack_require__(446),codeStr="//Globals are : sample (0,1,2..), rate (44100hz..), channel (0,1..)\n\n//use VOLUME   0.00 to 1.0  by 0.1;\n//use ATK      0.01 to 0.05 by 0.001;\n//use DESC     0.1  to 2.   by 0.01;\n//use FREQ     50   to 1800 by 10;\n//use HARMONIC 1.   to 7.   by 1.;\n//use INC      0.0  to 4.0  by 0.1;\n\n//Math Helper functions\nlet clamp = (x, a, b) => Math.max(a, Math.min(b,x))\nlet flatstep = (a,b,x) => clamp((x-a)/(b-a),0,1)\nlet ease = (t) => t<.5 ? 2*t*t : -1+(4-2*t)*t\nlet smoothstep = (a,b,x) => ease(flatstep(a,b,x))\nlet mix=(a,b,m) => a*(1.0-m)+b*m;\n//Sound Synthesis functions\nlet pure=(freq,t) => Math.sin(freq*t* 2* Math.PI)\nlet triangle=(freq,t) => Math.abs(((freq*t-0.25)%1.0)*2.0-1.0)*2.0-1.0\nlet square=(freq,t) => triangle(freq,t)>0.0 ? 1.0 : -1.0\nlet saw   =(freq,t) => (freq*t %1.0)*2. -1.\nlet atk=(d,t) => smoothstep(0,d,t)\nlet dec=(a,b,t) => Math.exp(-3*Math.max(0,t-a)/(b-a))\n\n//time in seconds\nlet t = sample / rate;\nlet s = 0.0;\n//0 is fundamental, others are harmonics\nfor(var i = 0; i<HARMONIC;i++){\n  let freq = FREQ * Math.pow(INC,i)\n  let shape = pure(freq,t)\n  let amplitude = Math.pow(0.5,i)\n  s+= amplitude*shape\n}\n//Envelope\nreturn s * atk(ATK,t) * dec(ATK,DESC,t)* VOLUME";function drawBuffer(e,_){var t=e.getContext("2d"),r=e.height,n=e.width,a=_.reduce((function(e,_){return _<e?_:e})),o=_.reduce((function(e,_){return _>e?_:e}));t.width=n,t.height=r,console.log(n),t.clearRect(0,0,n,r),t.fillStyle="#456",t.fillRect(0,0,n,r),t.strokeStyle="#977",t.lineWidth="1",t.beginPath(),t.moveTo(0,Math.floor(r/2)+.5),t.lineTo(n,Math.floor(r/2)+.5);var i=Math.ceil(r*(-1-a)/(o-a))+.5;t.moveTo(0,i),t.lineTo(n,i);var s=Math.floor(r*(1-a)/(o-a))-.5;t.moveTo(0,s),t.lineTo(n,s),t.stroke(),t.beginPath(),t.moveTo(0,r/2);for(var c=0;c<_.length;c++){var l=-_[c];t.lineTo(c/_.length*n,(l-a)/(o-a)*r)}t.strokeStyle="#000",t.lineWidth="1",t.stroke()}function hashCode(e){return e.split("").reduce((function(e,_){return(e=(e<<5)-e+_.charCodeAt(0))&e}),0)}var setQueryStringWithoutPageReload=function(e){var _=window.location.protocol+"//"+window.location.host+window.location.pathname+e;window.history.pushState({path:_},"",_)},setQueryStringValue=function(e,_){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.location.search,r=qs.parse(t),n=qs.stringify(Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__.a)(Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__.a)({},r),{},Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__.a)({},e,_)));setQueryStringWithoutPageReload("?".concat(n))},getQueryStringValue=function(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.search,t=qs.parse(_);return t[e]},ID=function(){return"_"+Math.random().toString(36).substr(2,9)};function generateJsSoundNode(){return{id:ID(),type:"JsSound",position:{x:150,y:20},data:{sample:44100,code:"let t = sample/rate;\n    return Math.sin(440.*t* Math.PI*2)*0.4;",cachedSample:null,params:[]}}}function generateSoundPlayerNode(){return{id:"SoundPlayerId",type:"SoundPlayer",data:{},position:{x:250,y:50}}}function generateSampleGeneratorNode(){return{id:ID(),type:"SampleGenerator",data:{count:44100},position:{x:0,y:50}}}var SampleGeneratorNodeStyles={background:"#9CA8B3",color:"#FFF",padding:10},SampleGeneratorNodeComponent=function(e){e.data;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:SampleGeneratorNodeStyles,children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_flow_renderer__WEBPACK_IMPORTED_MODULE_11__.a,{type:"source",position:"right",style:{borderRadius:0,backgroundColor:"white"}}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:"Generator"})]})},SoundPlayerNodeStyles={background:"#9CA8B3",color:"#FFF",padding:10},SoundPlayerNodeComponent=function(e){e.data;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:SoundPlayerNodeStyles,children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_flow_renderer__WEBPACK_IMPORTED_MODULE_11__.a,{type:"target",position:"left",style:{borderRadius:0,backgroundColor:"blue"}}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:"Speaker"})]})},JsSoundNodeStyles={background:"#9CA8B3",color:"#FFF",padding:10},JsSoundNodeComponent=function(e){e.data;return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:JsSoundNodeStyles,children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_flow_renderer__WEBPACK_IMPORTED_MODULE_11__.a,{id:"sample",type:"target",position:"left",style:{borderRadius:0,backgroundColor:"white"}}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:"JsSound"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_flow_renderer__WEBPACK_IMPORTED_MODULE_11__.a,{id:"sound",type:"source",position:"right",style:{borderRadius:0,backgroundColor:"blue"}})]})},nodeTypes={SoundPlayer:SoundPlayerNodeComponent,JsSound:JsSoundNodeComponent,SampleGenerator:SampleGeneratorNodeComponent},defaultJsSound=generateJsSoundNode(),defaultSoundPlayer=generateSoundPlayerNode(),defaultSampleGenerator=generateSampleGeneratorNode();function compileJsSoundCode(code,params){var hash=hashCode(code+params.map((function(e){return e.value+""})).join(";"));try{var paramsArgs=params.map((function(e){return e.name+","})).join(""),code2="((sample, rate,channel, {"+paramsArgs.slice(0,-1)+"}) => {"+code+"})",f=eval(code2),a=f(10,44100,1,{});return{func:f,valid:!0,hash:hash}}catch(e){return console.error("CANT USE CODE ",e),{func:function(){return 0},valid:!1,hash:hash}}}function computeJsSound(e,_){for(var t=new Array(_.data.count),r=0;r<t.length;r++)t[r]=e.compiled.func(r,44100,0);e.data.buffer=t}function compileElements(e){var _=e.find((function(e){return"SoundPlayerId"===e.target}));if(_){var t=e.find((function(e){return e.id===_.source}));if(t&&"JsSound"===t.type){var r=t,n=compileJsSoundCode(r.data.code,r.data.params);r.data.compiled=n}else console.err("CANT COMPILE : UNIMPLEMENTED FOR ",t.type)}return e}function getInitialData(){var e=getQueryStringValue("data");return e?JSON.parse(atob(e)):null}var initialData=getInitialData();function EditorFrag(){var e=Object(react__WEBPACK_IMPORTED_MODULE_4__.useState)(),_=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__.a)(e,2),t=_[0],r=_[1],n=Object(react__WEBPACK_IMPORTED_MODULE_4__.useState)((null===initialData||void 0===initialData?void 0:initialData.code)||codeStr),a=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__.a)(n,2),o=a[0],i=a[1],s=Object(react__WEBPACK_IMPORTED_MODULE_4__.useState)((null===initialData||void 0===initialData?void 0:initialData.params)||[]),c=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__.a)(s,2),l=c[0],u=c[1],d=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var e=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__.a)(o.matchAll("//use ([a-zA-Z0-9_]+) +([0-9.]+) +to +([0-9.]+) +by +([0-9.]*)+ *; *\n")),_={},t=l.slice(),r=!1;l.forEach((function(e){_[e.name]=0}));for(var n=function(){var n,o,i,s=e[a][1];n=parseFloat(e[a][2]),o=parseFloat(e[a][3]),i=parseFloat(e[a][4]);var c=l.findIndex((function(e){return e.name===s}));if(-1===c)r=!0,t.push({name:s,min:n,max:o,step:i,value:n>0?Math.sqrt(o*n):o/2});else{var u=l[c];u.min===n&&u.max===o&&u.step===i||(r=!0,u.min=n,u.max=o,u.step=i,u.value=n>0?Math.sqrt(o*n):o/2)}_[s]=(_[s]||0)+1},a=0;a<(null===e||void 0===e?void 0:e.length);a++)n();l.forEach((function(e){0===_[e.name]&&(r=!0,t=t.filter((function(_){return _.name!==e.name})))})),!0===r&&u(t)}),[o,l]);var p=Object(react__WEBPACK_IMPORTED_MODULE_4__.useMemo)((function(){return compileJsSoundCode(o,l)}),[o,l]),m=Object(react__WEBPACK_IMPORTED_MODULE_4__.useCallback)((function(){if(t&&t.audioCtx&&!0===p.valid){if(t.gainNode){for(var e=.05*t.audioCtx.sampleRate/10,_=new Float32Array(e),n=0;n<e;n++)_[n]=Math.pow(1-n/(e-1),2);t.gainNode.gain.setValueCurveAtTime(_,t.audioCtx.currentTime,.05)}for(var a=t.audioCtx.createBuffer(2,1*t.audioCtx.sampleRate,t.audioCtx.sampleRate),i=function(){c=a.getChannelData(s);var e={};for(l.forEach((function(_){return e[_.name]=_.value})),n=0;n<a.length;n++)try{c[n]=p.func(n,t.audioCtx.sampleRate,s,e)}catch(_){return{v:void 0}}},s=0;s<a.numberOfChannels;s++){var c,u=i();if("object"===typeof u)return u.v}var m={code:o,params:l},E=JSON.stringify(m),O=btoa(E);setQueryStringValue("data",O);var f=t.audioCtx.createBufferSource();f.buffer=a;var h=t.audioCtx.createGain();h.gain.value=1,f.connect(h),h.connect(t.audioCtx.destination),f.start(),drawBuffer(d.current,a.getChannelData(0)),r((function(e){return Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__.a)(Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_3__.a)({},e),{},{source:f,gainNode:h,hash:null===p||void 0===p?void 0:p.hash})}))}}),[t,p]);return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){!0===p.valid&&(null===t||void 0===t?void 0:t.hash)!==(null===p||void 0===p?void 0:p.hash)&&m()}),[p,m,t,l]),Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var e=new(window.AudioContext||window.webkitAudioContext);r({audioCtx:e})}),[]),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:{display:"flex",flexDirection:"column",background:"#789",height:window.innerHeight,overflow:"hidden"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:{display:"flex",flexDirection:"row",background:"#789",flex:"1 1 auto"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:"1 60 auto",margin:"10px",padding:"10px",background:"#EFF"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("button",{onClick:function(){m()},children:"Start"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsxs)("div",{style:{fontSize:"0.8em",marginTop:"10px"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:" Write your sound function on the right !"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:"The function will be evaluated for every sample (usually 44100 per second of playback) and played."}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{children:"Sliders are auto-generated by comments starting with //use."})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",marginTop:"20px",flexWrap:"wrap"},children:l.map((function(e){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_RSlider__WEBPACK_IMPORTED_MODULE_10__.a,{name:e.name,min:e.min,max:e.max,step:e.step,value:e.value,onChange:function(_){return u((function(t){var r=t.slice(),n=r.find((function(_){return _.name===e.name}));return n&&(n.value=_),r}))}})})}))}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{style:{flex:"5 1 auto"}})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{style:{flex:"1 1 auto",margin:"10px",padding:"10px",background:"#EFF",maxWidth:"890px"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(react_simple_code_editor__WEBPACK_IMPORTED_MODULE_5___default.a,{value:o,onValueChange:function(e){return i(e)},highlight:function(e){return Object(prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_6__.highlight)(e,prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_6__.languages.js)},padding:10,style:{fontFamily:'"Fira code", "Fira Mono", monospace',fontSize:12}})})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{style:{padding:"10px",flex:"1 1 auto"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("canvas",{ref:d,width:window.innerWidth-20+"",height:"300",style:{width:window.innerWidth-20+"px",minHeight:"50px"}})})]})}},132:function(e,_,t){"use strict";t.d(_,"a",(function(){return u}));var r=t(31),n=t(0),a=t(2);function o(e,_,t,r){return{x:e+t*Math.cos(r),y:_+t*Math.sin(r)}}function i(e,_,t,r,n){var a=o(e,_,t,n),i=o(e,_,t,r),s=n-r<=Math.PI?"0":"1";return["M",a.x,a.y,"A",t,t,0,s,0,i.x,i.y].join(" ")}var s=120;function c(e){var _=e.angle,t=Object(n.useMemo)((function(){var e=_+Math.PI/2,t=[i(90,90,70,Math.PI/2,e)];return e>=2.5*Math.PI&&(t=[i(90,90,70,Math.PI/2,1.99*Math.PI+Math.PI/2),i(90,90,70,Math.PI/2,e%(2*Math.PI))]),{arcpaths:t,cx:90+70*Math.cos(e),cy:90+70*Math.sin(e)}}),[_]);return Object(a.jsxs)("svg",{width:s,height:s,viewBox:"0 0 180 180",style:{padding:5,boxSizing:"border-box"},children:[Object(a.jsx)("circle",{r:70,cx:90,cy:90,strokeWidth:5,stroke:"#e9eaee",fill:"none"}),t.arcpaths.map((function(e,_){return Object(a.jsx)("path",{d:e,strokeLinecap:"round",strokeWidth:20,stroke:0===_?"#007aff":"#000000",fill:"none"})})),Object(a.jsx)("circle",{r:20,cx:t.cx,cy:t.cy,fill:"#fff",cursor:"pointer"})]})}function l(e,_){return Math.round(e)!==e?Math.round(_*(1/e))/(1/e)+"":Math.round(_)+""}function u(e){var _=e.min,t=e.max,o=e.step,i=e.value,s=e.onChange,u=(e.maxTurn,e.name),d=Object(n.useMemo)((function(){return 2*Math.PI*(i-_)/(t-_)})),p=Object(n.useRef)(),m=Object(n.useCallback)((function(e){var r=p.current.getBoundingClientRect(),n=r.width/2,a=e.clientX-r.left,i=e.clientY-r.top,c=Math.atan2(i-n,a-n);if(c=(c+2*Math.PI-Math.PI/2)%(2*Math.PI),c/=2*Math.PI,!isNaN(c)){var l=_+(t-_)*c;l=Math.max(_,Math.min(t,Math.round(l/o)*o)),s(l)}}),[s,_,t,o]),E=Object(n.useState)(!1),O=Object(r.a)(E,2),f=O[0],h=O[1];return Object(n.useEffect)((function(){window.addEventListener("mouseup",(function(){return h(!1)}))}),[]),Object(n.useEffect)((function(){if(f)return window.addEventListener("mousemove",m),function(){return window.removeEventListener("mousemove",m)}}),[f,m]),Object(a.jsx)("div",{children:Object(a.jsxs)("div",{ref:p,style:{width:"120px",height:"120px",position:"relative"},onMouseDown:function(e){h(!0),m(e)},children:[Object(a.jsx)(c,{angle:d}),Object(a.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},children:[Object(a.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",color:"grey"},children:u}),Object(a.jsx)("div",{style:{color:"#007aff"},children:l(o,i)})]})]})})}},139:function(e,_,t){},140:function(e,_,t){},447:function(e,_,t){"use strict";t.r(_);var r=t(0),n=t.n(r),a=t(30),o=t.n(a),i=(t(139),t.p,t(140),t(129)),s=t(2);var c=function(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(i.a,{})})},l=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,448)).then((function(_){var t=_.getCLS,r=_.getFID,n=_.getFCP,a=_.getLCP,o=_.getTTFB;t(e),r(e),n(e),a(e),o(e)}))};o.a.render(Object(s.jsx)(n.a.StrictMode,{children:Object(s.jsx)(c,{})}),document.getElementById("root")),l()}},[[447,1,2]]]);
//# sourceMappingURL=main.b2880c3f.chunk.js.map