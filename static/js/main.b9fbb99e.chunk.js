(this.webpackJsonpnatify=this.webpackJsonpnatify||[]).push([[0],{121:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return EditorFrag}));var _home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(74),_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(125),_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(28),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2),react__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_3__),react_simple_code_editor__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(122),react_simple_code_editor__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(react_simple_code_editor__WEBPACK_IMPORTED_MODULE_4__),prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(72),prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_5__),prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(132),prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(prismjs_components_prism_clike__WEBPACK_IMPORTED_MODULE_6__),prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(133),prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(prismjs_components_prism_javascript__WEBPACK_IMPORTED_MODULE_7__),_testing_library_dom__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(134),_RSlider__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(124),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__),codeStr="//Globals are : sample (0,1,2..), rate (44100hz..), channel (0,1..)\n\n//use VOLUME   0.00 to 1.0  by 0.1;\n//use ATK      0.01 to 0.05 by 0.001;\n//use DESC     0.1  to 2.   by 0.01;\n//use FREQ     50   to 1800 by 10;\n//use HARMONIC 1.   to 7.   by 1.;\n//use INC      0.0  to 4.0  by 0.1;\n\n//Math Helper functions\nlet clamp = (x, a, b) => Math.max(a, Math.min(b,x))\nlet flatstep = (a,b,x) => clamp((x-a)/(b-a),0,1)\nlet ease = (t) => t<.5 ? 2*t*t : -1+(4-2*t)*t\nlet smoothstep = (a,b,x) => ease(flatstep(a,b,x))\nlet mix=(a,b,m) => a*(1.0-m)+b*m;\n//Sound Synthesis functions\nlet pure=(freq,t) => Math.sin(freq*t* 2* Math.PI)\nlet triangle=(freq,t) => Math.abs(((freq*t-0.25) %1.0 )*2.0-1.0)*2.0-1.0\nlet square=(freq,t) => triangle(freq,t)>0.0 ? 1.0 : -1.0\nlet saw   =(freq,t) => (freq*t %1.0)*2. -1.\nlet atk=(d,t) => smoothstep(0,d,t)\nlet dec=(a,b,t) => Math.exp(-3*Math.max(0,t-a)/(b-a))\n\n//time in seconds\nlet t = sample / rate;\nlet s = 0.0;\n//0 is fundamental, others are harmonics\nfor(var i = 0; i<HARMONIC;i++){\n  let freq = FREQ * Math.pow(INC,i)\n  let shape = pure(freq,t)\n  let intensity = Math.pow(0.5,i)\n  s+= intensity*shape\n}\n//Envelope\ns *= atk(ATK,t)*dec(ATK,DESC,t)\nreturn s*VOLUME;";function drawBuffer(e,_){var t=e.getContext("2d"),a=e.height,r=e.width;t.width=r,t.height=a,console.log(r),t.clearRect(0,0,r,a),t.fillStyle="#456",t.fillRect(0,0,r,a),t.beginPath(),t.moveTo(0,Math.floor(a/2)+.5),t.lineTo(r,Math.floor(a/2)+.5),t.strokeStyle="#999",t.lineWidth="1",t.stroke(),t.beginPath(),t.moveTo(0,a/2);for(var n=0;n<_.length;n++){var o=-_[n];t.lineTo(n/_.length*r,(.5*o+.5)*a)}t.strokeStyle="#000",t.lineWidth="1",t.stroke()}function hashCode(e){return e.split("").reduce((function(e,_){return(e=(e<<5)-e+_.charCodeAt(0))&e}),0)}function EditorFrag(){var _useState=Object(react__WEBPACK_IMPORTED_MODULE_3__.useState)(),_useState2=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__.a)(_useState,2),astate=_useState2[0],setAstate=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_3__.useState)(codeStr),_useState4=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__.a)(_useState3,2),code=_useState4[0],setCode=_useState4[1],_useState5=Object(react__WEBPACK_IMPORTED_MODULE_3__.useState)([{name:"P_0",min:0,max:1,step:.01,value:.5}]),_useState6=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__.a)(_useState5,2),params=_useState6[0],setParams=_useState6[1],canvasRef=Object(react__WEBPACK_IMPORTED_MODULE_3__.useRef)();Object(react__WEBPACK_IMPORTED_MODULE_3__.useEffect)((function(){var e=Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__.a)(code.matchAll("//use ([a-zA-Z0-9_]+) +([0-9.]+) +to +([0-9.]+) +by +([0-9.]*)+ *; *\n")),_={},t=params.slice(),a=!1;params.forEach((function(e){_[e.name]=0}));for(var r=function(){var r,o,i,s=e[n][1];r=parseFloat(e[n][2]),o=parseFloat(e[n][3]),i=parseFloat(e[n][4]);var c=params.findIndex((function(e){return e.name===s}));if(-1===c)a=!0,t.push({name:s,min:r,max:o,step:i,value:r>0?Math.sqrt(o*r):o/2});else{var u=params[c];u.min===r&&u.max===o&&u.step===i||(a=!0,u.min=r,u.max=o,u.step=i,u.value=r>0?Math.sqrt(o*r):o/2)}_[s]=(_[s]||0)+1},n=0;n<(null===e||void 0===e?void 0:e.length);n++)r();params.forEach((function(e){0===_[e.name]&&(a=!0,t=t.filter((function(_){return _.name!==e.name})))})),!0===a&&setParams(t)}),[code,params]);var codeCompiled=Object(react__WEBPACK_IMPORTED_MODULE_3__.useMemo)((function(){var hash=hashCode(code+params.map((function(e){return e.value+""})).join(";"));try{var paramsArgs=params.map((function(e){return e.name+","})).join(""),code2="((sample, rate,channel, {"+paramsArgs.slice(0,-1)+"}) => {"+code+"})",f=eval(code2),a=f(10,44100,1,{});return{func:f,valid:!0,hash:hash}}catch(e){return console.error("CANT USE CODE ",e),{func:function(){return 0},valid:!1,hash:hash}}}),[code,params]),compute=Object(react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((function(){if(astate&&astate.audioCtx&&!0===codeCompiled.valid){if(astate.gainNode){for(var e=.05*astate.audioCtx.sampleRate/10,_=new Float32Array(e),t=0;t<e;t++)_[t]=Math.pow(1-t/(e-1),2);astate.gainNode.gain.setValueCurveAtTime(_,astate.audioCtx.currentTime,.05)}for(var a=astate.audioCtx.createBuffer(2,1*astate.audioCtx.sampleRate,astate.audioCtx.sampleRate),r=function(){o=a.getChannelData(n);var e={};for(params.forEach((function(_){return e[_.name]=_.value})),t=0;t<a.length;t++)try{o[t]=codeCompiled.func(t,astate.audioCtx.sampleRate,n,e)}catch(_){}},n=0;n<a.numberOfChannels;n++){var o;r()}var i=astate.audioCtx.createBufferSource();i.buffer=a;var s=astate.audioCtx.createGain();s.gain.value=1,i.connect(s),s.connect(astate.audioCtx.destination),i.start(),drawBuffer(canvasRef.current,a.getChannelData(0)),setAstate((function(e){return Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.a)(Object(_home_ctrl_prog_natify_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.a)({},e),{},{source:i,gainNode:s,hash:null===codeCompiled||void 0===codeCompiled?void 0:codeCompiled.hash})}))}}),[astate,codeCompiled]);return Object(react__WEBPACK_IMPORTED_MODULE_3__.useEffect)((function(){!0===codeCompiled.valid&&(null===astate||void 0===astate?void 0:astate.hash)!==(null===codeCompiled||void 0===codeCompiled?void 0:codeCompiled.hash)&&compute()}),[codeCompiled,compute,astate,params]),Object(react__WEBPACK_IMPORTED_MODULE_3__.useEffect)((function(){var e=new(window.AudioContext||window.webkitAudioContext);setAstate({audioCtx:e})}),[]),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{style:{display:"flex",flexDirection:"column",background:"#789",height:window.innerHeight,overflow:"hidden"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{style:{display:"flex",flexDirection:"row",background:"#789",flex:"1 1 auto"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:"1 60 auto",margin:"20px",padding:"20px",background:"#EFF"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("button",{onClick:function(){compute()},children:"Start"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{fontSize:"0.8em",marginTop:"10px"},children:"Write your sound function on the right ! Sliders are auto-generated by comments starting with //use."}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",marginTop:"20px",flexWrap:"wrap"},children:params.map((function(e){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_RSlider__WEBPACK_IMPORTED_MODULE_9__.a,{name:e.name,min:e.min,max:e.max,step:e.step,value:e.value,onChange:function(_){return setParams((function(t){var a=t.slice(),r=a.find((function(_){return _.name===e.name}));return r&&(r.value=_),a}))}})})}))}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{flex:"5 1 auto"}})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{flex:"1 1 auto",margin:"20px",padding:"20px",background:"#EFF",maxWidth:"890px"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(react_simple_code_editor__WEBPACK_IMPORTED_MODULE_4___default.a,{value:code,onValueChange:function(e){return setCode(e)},highlight:function(e){return Object(prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_5__.highlight)(e,prismjs_components_prism_core__WEBPACK_IMPORTED_MODULE_5__.languages.js)},padding:10,style:{fontFamily:'"Fira code", "Fira Mono", monospace',fontSize:12}})})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{style:{padding:"20px",flex:"none"},children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("canvas",{ref:canvasRef,width:window.innerWidth-40+"",height:"300",style:{width:window.innerWidth-40+"px",height:"300px"}})})]})}},124:function(e,_,t){"use strict";t.d(_,"a",(function(){return l}));var a=t(28),r=t(2),n=t(1);function o(e,_,t,a){return{x:e+t*Math.cos(a),y:_+t*Math.sin(a)}}function i(e,_,t,a,r){var n=o(e,_,t,r),i=o(e,_,t,a),s=r-a<=Math.PI?"0":"1";return["M",n.x,n.y,"A",t,t,0,s,0,i.x,i.y].join(" ")}var s=120;function c(e){var _=e.angle,t=Object(r.useMemo)((function(){var e=_+Math.PI/2,t=[i(90,90,70,Math.PI/2,e)];return e>=2.5*Math.PI&&(t=[i(90,90,70,Math.PI/2,1.99*Math.PI+Math.PI/2),i(90,90,70,Math.PI/2,e%(2*Math.PI))]),{arcpaths:t,cx:90+70*Math.cos(e),cy:90+70*Math.sin(e)}}),[_]);return Object(n.jsxs)("svg",{width:s,height:s,viewBox:"0 0 180 180",style:{padding:5,boxSizing:"border-box"},children:[Object(n.jsx)("circle",{r:70,cx:90,cy:90,strokeWidth:5,stroke:"#e9eaee",fill:"none"}),t.arcpaths.map((function(e,_){return Object(n.jsx)("path",{d:e,strokeLinecap:"round",strokeWidth:20,stroke:0===_?"#007aff":"#000000",fill:"none"})})),Object(n.jsx)("circle",{r:20,cx:t.cx,cy:t.cy,fill:"#fff",cursor:"pointer"})]})}function u(e,_){return Math.round(e)!==e?Math.round(_*(1/e))/(1/e)+"":Math.round(_)+""}function l(e){var _=e.min,t=e.max,o=e.step,i=e.value,s=e.onChange,l=(e.maxTurn,e.name),d=Object(r.useMemo)((function(){return 2*Math.PI*(i-_)/(t-_)})),p=Object(r.useRef)(),m=Object(r.useCallback)((function(e){var a=p.current.getBoundingClientRect(),r=a.width/2,n=e.clientX-a.left,i=e.clientY-a.top,c=Math.atan2(i-r,n-r);if(c=(c+2*Math.PI-Math.PI/2)%(2*Math.PI),c/=2*Math.PI,!isNaN(c)){var u=_+(t-_)*c;u=Math.max(_,Math.min(t,Math.round(u/o)*o)),s(u)}}),[s,_,t,o]),E=Object(r.useState)(!1),f=Object(a.a)(E,2),h=f[0],O=f[1];return Object(r.useEffect)((function(){window.addEventListener("mouseup",(function(){return O(!1)}))}),[]),Object(r.useEffect)((function(){if(h)return window.addEventListener("mousemove",m),function(){return window.removeEventListener("mousemove",m)}}),[h,m]),Object(n.jsx)("div",{children:Object(n.jsxs)("div",{ref:p,style:{width:"120px",height:"120px",position:"relative"},onMouseDown:function(e){O(!0),m(e)},children:[Object(n.jsx)(c,{angle:d}),Object(n.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},children:[Object(n.jsx)("div",{style:{fontSize:"0.8em",fontWeight:"bold",color:"grey"},children:l}),Object(n.jsx)("div",{style:{color:"#007aff"},children:u(o,i)})]})]})})}},130:function(e,_,t){},131:function(e,_,t){},432:function(e,_,t){"use strict";t.r(_);var a=t(2),r=t.n(a),n=t(120),o=t.n(n),i=(t(130),t.p,t(131),t(121)),s=t(1);var c=function(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(i.a,{})})},u=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,433)).then((function(_){var t=_.getCLS,a=_.getFID,r=_.getFCP,n=_.getLCP,o=_.getTTFB;t(e),a(e),r(e),n(e),o(e)}))};o.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(c,{})}),document.getElementById("root")),u()}},[[432,1,2]]]);
//# sourceMappingURL=main.b9fbb99e.chunk.js.map